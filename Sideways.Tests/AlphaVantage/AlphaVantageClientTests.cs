namespace Sideways.Tests.AlphaVantage
{
    using System;
    using System.Net;
    using System.Net.Http;
    using System.Threading;
    using System.Threading.Tasks;

    using NUnit.Framework;

    using Sideways.AlphaVantage;

    public static class AlphaVantageClientTests
    {
        private static readonly AlphaVantageClientSettings? ClientSettings = Settings.FromFile()?.AlphaVantage?.ClientSettings;

        [Explicit("Hits endpoint.")]
        [Test]
        public static async Task ListingsAsync()
        {
            using var client = new AlphaVantageClient(new HttpClientHandler(), ClientSettings!.ApiKey!, ClientSettings.MaxCallsPerMinute);
            var candles = await client.ListingsAsync().ConfigureAwait(false);
            Assert.AreEqual(100, candles.Length);
        }

        [Test]
        public static async Task ListingsUsingMock()
        {
            const string csv = @"symbol,name,exchange,assetType,ipoDate,delistingDate,status
A,Agilent Technologies Inc,NYSE,Stock,1999-11-18,null,Active
AA,Alcoa Corp,NYSE,Stock,2016-11-01,null,Active
AAA,AAF First Priority CLO Bond ETF,NYSE ARCA,ETF,2020-09-09,null,Active
AAAU,Goldman Sachs Physical Gold ETF,NYSE ARCA,ETF,2018-08-15,null,Active
AAC,Ares Acquisition Corporation - Class A,NYSE,Stock,2021-03-25,null,Active
AAC-U,Ares Acquisition Corporation - Units (1 Ord Share Class A & 1/5 War),NYSE,Stock,2021-02-02,null,Active
AAC-WS,Ares Acquisition Corporation - Warrants (01/01/9999),NYSE,Stock,2021-03-25,null,Active
AACG,ATA Creativity Global,NASDAQ,Stock,2008-01-29,null,Active
AACQ,Artius Acquisition Inc - Class A,NASDAQ,Stock,2020-09-04,null,Active
AACQU,Artius Acquisition Inc - Units (1 Ord Share Class A & 1/3 War),NASDAQ,Stock,2020-07-14,null,Active
AACQW,Artius Acquisition Inc - Warrants (13/07/2025),NASDAQ,Stock,2020-09-04,null,Active
AADR,AdvisorShares Dorsey Wright ADR ETF,NYSE ARCA,ETF,2010-07-21,null,Active
AAIC,Arlington Asset Investment Corp - Class A,NYSE,Stock,1997-12-23,null,Active
AAIC-P-B,Arlington Asset Investment Corp,NYSE,Stock,2017-05-16,null,Active
AAIC-P-C,Arlington Asset Investment Corp,NYSE,Stock,2019-03-06,null,Active
AAL,American Airlines Group Inc,NASDAQ,Stock,2005-09-27,null,Active
AAMC,Altisource Asset Management Corp,NYSE MKT,Stock,2012-12-13,null,Active
AAME,Atlantic American Corp,NASDAQ,Stock,1984-09-07,null,Active
AAN,Aarons Company Inc (The),NYSE,Stock,2020-11-25,null,Active
AAN-W,Aarons Holdings Company Inc When Issued,NYSE,Stock,2020-11-25,null,Active
AAOI,Applied Optoelectronics Inc,NASDAQ,Stock,2013-09-26,null,Active
AAON,AAON Inc,NASDAQ,Stock,1992-12-16,null,Active
AAP,Advance Auto Parts Inc,NYSE,Stock,2001-11-29,null,Active
AAPL,Apple Inc,NASDAQ,Stock,1980-12-12,null,Active";
            using var client = new AlphaVantageClient(new MockHandler(csv), string.Empty, int.MaxValue);
            var candles = await client.ListingsAsync().ConfigureAwait(false);
            Assert.AreEqual(24, candles.Length);

            // 2021-04-01 20:00:00,242.3000,242.5800,242.2800,242.5500,11638
            Assert.AreEqual(
                new Listing(
                    "A",
                    "Agilent Technologies Inc",
                    "NYSE",
                    "Stock",
                    new DateTimeOffset(1999, 11, 18, 0, 0, 0, 0, TimeSpan.Zero),
                    null),
                candles[0]);

            // 2021-03-24 17:00:00,235.4600,235.8000,234.9900,235.1000,1087423
            Assert.AreEqual(
                new Listing(
                    "AAPL",
                    "Apple Inc",
                    "NASDAQ",
                    "Stock",
                    new DateTimeOffset(1980, 12, 12, 0, 0, 0, 0, TimeSpan.Zero),
                    null),
                candles[23]);
        }

        [Explicit("Hits endpoint.")]
        [Test]
        public static async Task IntradayAsync()
        {
            using var client = new AlphaVantageClient(new HttpClientHandler(), ClientSettings!.ApiKey!, ClientSettings.MaxCallsPerMinute);
            var candles = await client.IntradayAsync("MSFT", Interval.Hour, adjusted: false, outputSize: OutputSize.Compact);
            Assert.AreEqual(100, candles.Length);
        }

        [Test]
        public static async Task IntradayAsyncHourUsingMock()
        {
            const string csv = @"timestamp,open,high,low,close,volume
2021-04-01 20:00:00,242.3000,242.5800,242.2800,242.5500,11638
2021-04-01 19:00:00,242.3500,242.4500,242.1000,242.4000,13005
2021-04-01 18:00:00,242.4700,242.6100,242.3500,242.3500,405056
2021-04-01 17:00:00,242.3500,242.5400,242.1800,242.5000,957326
2021-04-01 16:00:00,241.8800,242.6400,241.2200,242.3500,4824710
2021-04-01 15:00:00,241.7399,242.1000,241.6100,241.8850,2412756
2021-04-01 14:00:00,241.6200,241.9299,241.2084,241.7400,2301106
2021-04-01 13:00:00,241.4500,241.6700,240.8200,241.6100,2265818
2021-04-01 12:00:00,241.8100,241.9656,240.7500,241.4600,3153745
2021-04-01 11:00:00,241.4250,242.0600,240.5600,241.8300,5737920
2021-04-01 10:00:00,238.3200,241.4250,235.7700,241.4238,5652865
2021-04-01 09:00:00,238.4504,238.8000,235.7700,238.3300,132771
2021-04-01 08:00:00,238.5600,238.6500,238.2700,238.4700,52478
2021-04-01 07:00:00,238.5300,238.5600,238.0100,238.5300,24662
2021-04-01 06:00:00,238.5000,238.7500,238.3000,238.5600,13343
2021-04-01 05:00:00,238.8200,238.9700,238.5000,238.5000,10483
2021-03-31 20:00:00,237.5000,237.5400,237.0300,237.5300,37055
2021-03-31 19:00:00,237.6700,237.7500,237.5000,237.5000,25151
2021-03-31 18:00:00,237.4100,238.0000,237.0000,237.5000,167602
2021-03-31 17:00:00,236.2200,237.2900,235.7700,237.2600,3696681
2021-03-31 16:00:00,234.4900,239.1000,234.4700,235.7700,16937254
2021-03-31 15:00:00,235.6500,235.6750,234.1100,234.5000,2444335
2021-03-31 14:00:00,236.2400,236.5600,235.6200,235.6400,1650140
2021-03-31 13:00:00,236.2450,236.8500,236.2100,236.2400,2130281
2021-03-31 12:00:00,235.5400,236.2650,235.0600,236.2450,2433583
2021-03-31 11:00:00,233.7900,236.0700,233.7900,235.5600,3994133
2021-03-31 10:00:00,232.8500,233.8500,232.3900,233.8000,3257101
2021-03-31 09:00:00,233.0094,233.0500,231.2710,232.8600,55391
2021-03-31 08:00:00,232.8700,233.0200,232.7100,232.9800,19085
2021-03-31 07:00:00,232.5100,233.0100,232.5100,232.9600,2984
2021-03-31 06:00:00,232.1000,232.4900,231.9400,232.4900,3920
2021-03-31 05:00:00,232.0000,232.6000,231.6600,232.2700,3758
2021-03-30 20:00:00,231.8100,231.9000,231.6900,231.8900,15155
2021-03-30 19:00:00,231.8800,231.8999,231.6100,231.6100,5841
2021-03-30 18:00:00,231.9200,231.9600,231.8300,231.8800,19077
2021-03-30 17:00:00,231.8500,232.0900,231.7000,231.9100,943482
2021-03-30 16:00:00,232.2506,232.5000,231.3200,232.4300,4817219
2021-03-30 15:00:00,231.9486,232.3300,231.5900,232.2500,1748301
2021-03-30 14:00:00,231.8400,232.4500,231.5800,231.9500,1544295
2021-03-30 13:00:00,231.9800,232.2000,231.5800,231.8300,2051510
2021-03-30 12:00:00,231.9600,232.6850,231.6100,231.9850,2999413
2021-03-30 11:00:00,232.2300,232.9000,231.1000,231.9500,4084693
2021-03-30 10:00:00,233.4000,234.2500,231.5400,232.2500,3251462
2021-03-30 09:00:00,233.1000,234.6520,232.7200,233.1100,37510
2021-03-30 08:00:00,233.0800,233.5800,232.7600,233.1200,45841
2021-03-30 07:00:00,233.6900,233.6900,232.6500,233.1700,12716
2021-03-30 06:00:00,233.4400,233.8000,233.4400,233.8000,331
2021-03-30 05:00:00,234.3200,234.5000,233.0400,233.5100,6244
2021-03-29 20:00:00,235.2900,235.5000,235.1500,235.4900,7663
2021-03-29 19:00:00,235.3200,235.6600,235.2600,235.5800,8860
2021-03-29 18:00:00,235.3017,235.3113,235.0563,235.3113,5671
2021-03-29 17:00:00,235.2400,235.9500,235.0300,235.3000,3192465
2021-03-29 16:00:00,234.4700,235.3100,234.3762,235.2800,3190330
2021-03-29 15:00:00,235.1500,235.1600,234.2600,234.4500,1982615
2021-03-29 14:00:00,234.9500,235.6400,234.8200,235.1155,2180300
2021-03-29 13:00:00,233.6000,234.9600,233.0200,234.9305,2162694
2021-03-29 12:00:00,233.5800,234.0000,232.9500,233.6000,2305399
2021-03-29 11:00:00,233.1000,233.9750,231.8800,233.5600,4036222
2021-03-29 10:00:00,235.1000,237.0000,232.9800,233.1000,3161297
2021-03-29 09:00:00,235.9500,236.5373,235.0000,235.1000,29100
2021-03-29 08:00:00,236.4000,236.5000,235.7200,236.2500,16462
2021-03-29 07:00:00,235.8000,235.9400,235.6000,235.9400,2819
2021-03-29 06:00:00,234.9000,235.8000,234.9000,235.8000,3271
2021-03-29 05:00:00,235.9600,235.9600,234.9500,234.9500,1348
2021-03-26 20:00:00,236.1300,236.2900,236.0300,236.0300,4227
2021-03-26 19:00:00,236.2100,236.3000,236.1300,236.2100,3632
2021-03-26 18:00:00,236.2000,236.5100,235.7500,236.2000,26418
2021-03-26 17:00:00,236.4800,236.7100,235.8600,236.0000,2010365
2021-03-26 16:00:00,233.7000,236.7100,233.5600,236.4800,5097796
2021-03-26 15:00:00,234.5500,234.8000,233.0300,233.7000,3103459
2021-03-26 14:00:00,234.8000,235.4400,234.4200,234.5500,2061674
2021-03-26 13:00:00,234.9900,235.1800,234.0100,234.8000,2081471
2021-03-26 12:00:00,233.8100,234.9900,232.7700,234.9900,2632050
2021-03-26 11:00:00,233.0800,234.1500,232.4300,233.8100,2724325
2021-03-26 10:00:00,232.2500,233.9400,231.3500,233.0800,2367234
2021-03-26 09:00:00,232.2500,232.8000,230.6000,231.8200,63355
2021-03-26 08:00:00,232.5000,232.6000,231.1600,231.9500,32086
2021-03-26 07:00:00,232.9000,232.9000,232.2000,232.2000,9404
2021-03-26 06:00:00,232.6000,232.7100,232.5000,232.7100,1237
2021-03-26 05:00:00,233.6600,233.6600,232.6000,232.6000,1450
2021-03-25 20:00:00,232.6400,234.0000,232.5500,233.5200,32371
2021-03-25 19:00:00,232.5400,232.6000,232.4000,232.6000,16664
2021-03-25 18:00:00,232.6200,232.7900,232.3400,232.7500,33064
2021-03-25 17:00:00,232.3400,232.6300,232.2950,232.4300,1118697
2021-03-25 16:00:00,232.9300,233.6100,232.2200,232.2700,5620665
2021-03-25 15:00:00,232.3300,233.1200,231.6100,232.9350,3210008
2021-03-25 14:00:00,232.1500,233.1200,231.5700,232.3000,3393680
2021-03-25 13:00:00,232.3200,232.7200,231.7800,232.1550,3369852
2021-03-25 12:00:00,232.8900,233.1300,231.5700,232.3100,4999420
2021-03-25 11:00:00,235.8300,236.9400,232.7300,232.8800,4894708
2021-03-25 10:00:00,235.4900,236.8050,234.5950,235.8500,3608433
2021-03-25 09:00:00,235.0000,236.0000,234.3000,235.3400,95748
2021-03-25 08:00:00,235.7200,236.0000,234.5000,235.2500,28968
2021-03-25 07:00:00,235.4700,235.6700,235.4700,235.6700,600
2021-03-25 06:00:00,235.6000,235.6000,235.2900,235.2900,771
2021-03-25 05:00:00,235.0000,236.1700,235.0000,236.1700,907
2021-03-24 20:00:00,235.7400,235.7900,235.3400,235.3400,7493
2021-03-24 19:00:00,235.2500,235.9400,235.2000,235.5900,19985
2021-03-24 18:00:00,235.1700,235.2500,235.1700,235.2400,5015
2021-03-24 17:00:00,235.4600,235.8000,234.9900,235.1000,1087423";
            using var client = new AlphaVantageClient(new MockHandler(csv), string.Empty, int.MaxValue);
            var candles = await client.IntradayAsync("MSFT", Interval.Hour, adjusted: false, outputSize: OutputSize.Compact);
            Assert.AreEqual(100, candles.Length);

            // 2021-04-01 20:00:00,242.3000,242.5800,242.2800,242.5500,11638
            Assert.AreEqual(
                new Candle(
                    new DateTimeOffset(2021, 04, 01, 20, 0, 0, 0, TimeSpan.Zero),
                    242.30f,
                    242.58f,
                    242.28f,
                    242.550f,
                    11638),
                candles[0]);

            // 2021-03-24 17:00:00,235.4600,235.8000,234.9900,235.1000,1087423
            Assert.AreEqual(
                new Candle(
                    new DateTimeOffset(2021, 03, 24, 17, 0, 0, 0, TimeSpan.Zero),
                    235.4600f,
                    235.800f,
                    234.9900f,
                    235.1000f,
                    1087423),
                candles[99]);
        }

        [Explicit("Hits endpoint.")]
        [Test]
        public static async Task IntradayExtendedAsync()
        {
            using var client = new AlphaVantageClient(new HttpClientHandler(), ClientSettings!.ApiKey!, ClientSettings.MaxCallsPerMinute);
            var candles = await client.IntradayExtendedAsync("MSFT", Interval.Minute, Slice.Year1Month1, adjusted: false, CancellationToken.None);
            Assert.AreEqual(100, candles.Length);
        }

        [Test]
        public static async Task IntradayExtendedAsyncMinuteUsingMock()
        {
            const string csv = "time,open,high,low,close,volume\r\n" +
                               "2021-04-01 20:00:00,242.12,242.13,242.14,242.15,1112\r\n" +
                               "2021-04-01 19:59:00,242.55,242.55,242.55,242.55,209\r\n" +
                               "2021-04-01 19:55:00,243.12,243.13,243.14,243.15,265";
            using var client = new AlphaVantageClient(new MockHandler(csv), string.Empty, int.MaxValue);
            var candles = await client.IntradayExtendedAsync("MSFT", Interval.Minute, Slice.Year1Month1, adjusted: false, CancellationToken.None);
            Assert.AreEqual(3, candles.Length);
            Assert.AreEqual(
                new Candle(
                    new DateTimeOffset(2021, 04, 01, 20, 0, 0, 0, TimeSpan.Zero),
                    242.12f,
                    242.13f,
                    242.14f,
                    242.15f,
                    1112),
                candles[0]);

            Assert.AreEqual(
                new Candle(
                    new DateTimeOffset(2021, 04, 01, 19, 55, 00, 0, TimeSpan.Zero),
                    243.12f,
                    243.13f,
                    243.14f,
                    243.15f,
                    265),
                candles[2]);
        }

        [Explicit("Hits endpoint.")]
        [Test]
        public static async Task DailyAsync()
        {
            using var client = new AlphaVantageClient(new HttpClientHandler(), ClientSettings!.ApiKey!, ClientSettings.MaxCallsPerMinute);
            var candles = await client.DailyAsync("MSFT", OutputSize.Compact, CancellationToken.None);
            Assert.AreEqual(100, candles.Length);
        }

        [Test]
        public static async Task DailyAsyncUsingMock()
        {
            const string csv = @"timestamp,open,high,low,close,volume
2021-04-01,238.4700,242.8400,238.0501,242.3500,30337982
2021-03-31,232.9100,239.1000,232.3900,235.7700,43623471
2021-03-30,233.5250,233.8500,231.1000,231.8500,24792012
2021-03-29,236.5900,236.8000,231.8800,235.2400,25227455
2021-03-26,231.5500,236.7100,231.5500,236.4800,25479853
2021-03-25,235.3000,236.9400,231.5700,232.3400,34061853
2021-03-24,237.8450,238.0000,235.3200,235.4600,25620127
2021-03-23,237.4850,241.0500,237.0700,237.5800,31638376
2021-03-22,230.2700,236.9000,230.1400,235.9900,30127005
2021-03-19,231.0200,232.4740,229.3496,230.3500,46430730
2021-03-18,232.5600,234.1900,230.3300,230.7200,34852251
2021-03-17,236.1500,238.5500,233.2300,237.0400,29562100
2021-03-16,236.2800,240.0550,235.9400,237.7100,28092196
2021-03-15,234.9600,235.1850,231.8100,234.8100,26042669
2021-03-12,234.0100,235.8200,233.2300,235.7500,22653662
2021-03-11,234.9600,239.1700,234.3100,237.1300,29907586
2021-03-10,237.0000,237.0000,232.0400,232.4200,29746812
2021-03-09,232.8800,235.3839,231.6700,233.7800,33080531
2021-03-08,231.3700,233.3650,227.1300,227.3900,35267440
2021-03-05,229.5165,233.2700,226.4600,231.6000,41872770
2021-03-04,226.7350,232.4900,224.2600,226.7300,44727785
2021-03-03,232.1550,233.5799,227.2600,227.5600,34029526
2021-03-02,237.0100,237.3000,233.4500,233.8700,22812459
2021-03-01,235.9000,237.4700,233.1500,236.9400,25332837
2021-02-26,231.5250,235.3700,229.5400,232.3800,37545055
2021-02-25,232.0800,234.5852,227.8800,228.9900,39118089
2021-02-24,230.0100,235.2000,229.0000,234.5500,26339746
2021-02-23,230.3250,234.8300,228.7300,233.2700,30228704
2021-02-22,237.4200,237.9300,232.4000,234.5100,36182764
2021-02-19,243.7500,243.8600,240.1800,240.9700,25262600
2021-02-18,241.8000,243.9300,240.8600,243.7900,16925563
2021-02-17,241.3200,244.3100,240.9400,244.2000,21451617
2021-02-16,245.0300,246.1300,242.9200,243.7000,26728487
2021-02-12,243.9332,245.3000,242.7300,244.9900,16561079
2021-02-11,244.7800,245.1500,242.1500,244.4900,15751059
2021-02-10,245.0000,245.9200,240.8900,242.8200,22117240
2021-02-09,241.8700,244.7600,241.3800,243.7700,23471475
2021-02-08,243.1500,243.6800,240.8100,242.4700,22211929
2021-02-05,242.2300,243.2800,240.4200,242.2000,18054752
2021-02-04,242.6600,243.2399,240.3700,242.0100,25296100
2021-02-03,239.5700,245.0900,239.2600,243.0000,27158104
2021-02-02,241.3000,242.3100,238.6900,239.5100,25678356
2021-02-01,235.0600,242.5000,232.4300,239.6500,33314193
2021-01-29,235.9900,238.0200,231.3500,231.9600,42503138
2021-01-28,235.6100,242.6400,235.0900,238.9300,49111159
2021-01-27,238.0000,240.4400,230.1400,232.9000,69870638
2021-01-26,231.8600,234.1800,230.0800,232.3300,49169601
2021-01-25,229.1200,229.7800,224.2200,229.5300,33152095
2021-01-22,227.0800,230.0700,225.8000,225.9500,30172663
2021-01-21,224.7000,226.3000,222.4200,224.9700,30749553
2021-01-20,217.7000,225.7900,217.2908,224.3400,37777260
2021-01-19,213.7500,216.9800,212.6300,216.4400,30480859
2021-01-15,213.5200,214.5100,212.0300,212.6500,31746512
2021-01-14,215.9100,217.4600,212.7400,213.0200,29346737
2021-01-13,214.0200,216.7600,213.9266,216.3400,20087080
2021-01-12,216.5000,217.1000,213.3202,214.9300,23148341
2021-01-11,218.4700,218.9100,216.7300,217.4900,23047029
2021-01-08,218.6800,220.5800,217.0261,219.6200,22956206
2021-01-07,214.0400,219.3400,213.7100,218.2900,27694480
2021-01-06,212.1700,216.4899,211.9400,212.2500,35930653
2021-01-05,217.2600,218.5200,215.7000,217.9000,23822953
2021-01-04,222.5300,223.0000,214.8100,217.6900,37130139
2020-12-31,221.7000,223.0000,219.6800,222.4200,20942132
2020-12-30,225.2300,225.6300,221.4700,221.6800,20272337
2020-12-29,226.3100,227.1800,223.5800,224.1500,17403213
2020-12-28,224.4500,226.0300,223.0200,224.9600,17762701
2020-12-24,221.4200,223.6100,221.2000,222.7500,10550572
2020-12-23,223.1100,223.5589,220.8000,221.0200,18699638
2020-12-22,222.6900,225.6300,221.8500,223.9400,22643397
2020-12-21,217.5500,224.0000,217.2801,222.5900,37181886
2020-12-18,218.5900,219.6900,216.0200,218.5900,63354922
2020-12-17,219.8700,220.8900,217.9200,219.4200,32515784
2020-12-16,214.7500,220.1100,214.7200,219.2800,35023253
2020-12-15,215.1650,215.4200,212.2400,214.1300,27018106
2020-12-14,213.1000,216.2100,212.8800,214.2000,28798379
2020-12-11,210.0500,213.3200,209.1100,213.2600,30979440
2020-12-10,211.7700,213.0800,210.3600,210.5200,26467017
2020-12-09,215.1600,215.2250,211.2140,211.8000,32440603
2020-12-08,213.9700,216.9500,212.8900,216.0100,23284094
2020-12-07,214.3700,215.5400,212.9900,214.2900,24619997
2020-12-04,214.2200,215.3800,213.1800,214.3600,24666039
2020-12-03,214.6100,216.3757,213.6500,214.2400,25120922
2020-12-02,214.8800,215.4700,212.8000,215.3700,23724509
2020-12-01,214.5100,217.3200,213.3500,216.2100,30498026
2020-11-30,214.1000,214.7600,210.8350,214.0700,33064753
2020-11-27,214.8500,216.2700,214.0400,215.2300,14512213
2020-11-25,215.1100,215.2900,212.4600,213.8700,21012887
2020-11-24,209.5900,214.2500,208.8600,213.8600,33830438
2020-11-23,210.9500,212.2900,208.1600,210.1100,25683507
2020-11-20,212.2000,213.2850,210.0000,210.3900,22843119
2020-11-19,211.3800,213.0300,209.9300,212.4200,24792746
2020-11-18,213.6500,215.1700,210.9300,211.0800,28372789
2020-11-17,216.1000,217.6800,214.0800,214.4600,24154112
2020-11-16,214.8700,217.7400,214.5200,217.2300,24953344
2020-11-13,216.3600,217.4200,214.1600,216.5100,18630307
2020-11-12,217.2100,219.1100,214.4600,215.4400,21616115
2020-11-11,212.3900,218.0400,212.2000,216.5500,29440788
2020-11-10,214.5000,216.5000,209.7200,211.0100,44045120
2020-11-09,224.4350,228.1200,217.8800,218.3900,44394950
2020-11-06,222.2600,224.3600,218.0300,223.7200,25231895
";
            using var client = new AlphaVantageClient(new MockHandler(csv), string.Empty, int.MaxValue);
            var candles = await client.DailyAsync("MSFT", OutputSize.Compact, CancellationToken.None);
            Assert.AreEqual(100, candles.Length);
            Assert.AreEqual(
                new Candle(
                    new DateTimeOffset(2021, 04, 01, 0, 0, 0, 0, TimeSpan.Zero),
                    238.47f,
                    242.84f,
                    238.0501f,
                    242.35f,
                    30337982),
                candles[0]);

            Assert.AreEqual(
                new Candle(
                    new DateTimeOffset(2020, 11, 06, 0, 0, 0, 0, TimeSpan.Zero),
                    222.26f,
                    224.36f,
                    218.03f,
                    223.72f,
                    25231895),
                candles[99]);
        }

        [Explicit("Hits endpoint.")]
        [Test]
        public static async Task DailyAdjustedAsync()
        {
            using var client = new AlphaVantageClient(new HttpClientHandler(), ClientSettings!.ApiKey!, ClientSettings.MaxCallsPerMinute);
            var candles = await client.DailyAdjustedAsync("MSFT", OutputSize.Compact, CancellationToken.None);
            Assert.AreEqual(100, candles.Length);
        }

        [Test]
        public static async Task DailyAdjustedAsyncUsingMock()
        {
            const string csv = @"timestamp,open,high,low,close,adjusted_close,volume,dividend_amount,split_coefficient
2021-04-01,238.47,242.84,238.0501,242.35,242.35,30337982,0.0000,1.0
2021-03-31,232.91,239.1,232.39,235.77,235.77,43623471,0.0000,1.0
2021-03-30,233.525,233.85,231.1,231.85,231.85,24792012,0.0000,1.0
2021-03-29,236.59,236.8,231.88,235.24,235.24,25227455,0.0000,1.0
2021-03-26,231.55,236.71,231.55,236.48,236.48,25479853,0.0000,1.0
2021-03-25,235.3,236.94,231.57,232.34,232.34,34061853,0.0000,1.0
2021-03-24,237.845,238.0,235.32,235.46,235.46,25620127,0.0000,1.0
2021-03-23,237.485,241.05,237.07,237.58,237.58,31638376,0.0000,1.0
2021-03-22,230.27,236.9,230.14,235.99,235.99,30127005,0.0000,1.0
2021-03-19,231.02,232.474,229.3496,230.35,230.35,46430730,0.0000,1.0
2021-03-18,232.56,234.19,230.33,230.72,230.72,34852251,0.0000,1.0
2021-03-17,236.15,238.55,233.23,237.04,237.04,29562100,0.0000,1.0
2021-03-16,236.28,240.055,235.94,237.71,237.71,28092196,0.0000,1.0
2021-03-15,234.96,235.185,231.81,234.81,234.81,26042669,0.0000,1.0
2021-03-12,234.01,235.82,233.23,235.75,235.75,22653662,0.0000,1.0
2021-03-11,234.96,239.17,234.31,237.13,237.13,29907586,0.0000,1.0
2021-03-10,237.0,237.0,232.04,232.42,232.42,29746812,0.0000,1.0
2021-03-09,232.88,235.3839,231.67,233.78,233.78,33080531,0.0000,1.0
2021-03-08,231.37,233.365,227.13,227.39,227.39,35267440,0.0000,1.0
2021-03-05,229.5165,233.27,226.46,231.6,231.6,41872770,0.0000,1.0
2021-03-04,226.735,232.49,224.26,226.73,226.73,44727785,0.0000,1.0
2021-03-03,232.155,233.5799,227.26,227.56,227.56,34029526,0.0000,1.0
2021-03-02,237.01,237.3,233.45,233.87,233.87,22812459,0.0000,1.0
2021-03-01,235.9,237.47,233.15,236.94,236.94,25332837,0.0000,1.0
2021-02-26,231.525,235.37,229.54,232.38,232.38,37545055,0.0000,1.0
2021-02-25,232.08,234.5852,227.88,228.99,228.99,39118089,0.0000,1.0
2021-02-24,230.01,235.2,229.0,234.55,234.55,26339746,0.0000,1.0
2021-02-23,230.325,234.83,228.73,233.27,233.27,30228704,0.0000,1.0
2021-02-22,237.42,237.93,232.4,234.51,234.51,36182764,0.0000,1.0
2021-02-19,243.75,243.86,240.18,240.97,240.97,25262600,0.0000,1.0
2021-02-18,241.8,243.93,240.86,243.79,243.79,16925563,0.0000,1.0
2021-02-17,241.32,244.31,240.94,244.2,244.2,21451617,0.5600,1.0
2021-02-16,245.03,246.13,242.92,243.7,243.142425233,26728487,0.0000,1.0
2021-02-12,243.9332,245.3,242.73,244.99,244.42947377,16561079,0.0000,1.0
2021-02-11,244.78,245.15,242.15,244.49,243.930617748,15751059,0.0000,1.0
2021-02-10,245.0,245.92,240.89,242.82,242.264438634,22117240,0.0000,1.0
2021-02-09,241.87,244.76,241.38,243.77,243.212265076,23471475,0.0000,1.0
2021-02-08,243.15,243.68,240.81,242.47,241.915239418,22211929,0.0000,1.0
2021-02-05,242.23,243.28,240.42,242.2,241.645857166,18054752,0.0000,1.0
2021-02-04,242.66,243.2399,240.37,242.01,241.456291878,25296100,0.0000,1.0
2021-02-03,239.57,245.09,239.26,243.0,242.444026802,27158104,0.0000,1.0
2021-02-02,241.3,242.31,238.69,239.51,238.962011767,25678356,0.0000,1.0
2021-02-01,235.06,242.5,232.43,239.65,239.101691453,33314193,0.0000,1.0
2021-01-29,235.99,238.02,231.35,231.96,231.429285831,42503138,0.0000,1.0
2021-01-28,235.61,242.64,235.09,238.93,238.383338781,49111159,0.0000,1.0
2021-01-27,238.0,240.44,230.14,232.9,232.367135153,69870638,0.0000,1.0
2021-01-26,231.86,234.18,230.08,232.33,231.798439287,49169601,0.0000,1.0
2021-01-25,229.12,229.78,224.22,229.53,229.004845563,33152095,0.0000,1.0
2021-01-22,227.08,230.07,225.8,225.95,225.433036444,30172663,0.0000,1.0
2021-01-21,224.7,226.3,222.42,224.97,224.45527864,30749553,0.0000,1.0
2021-01-20,217.7,225.79,217.2908,224.34,223.826720052,37777260,0.0000,1.0
2021-01-19,213.75,216.98,212.63,216.44,215.944794901,30480859,0.0000,1.0
2021-01-15,213.52,214.51,212.03,212.65,212.163466253,31746512,0.0000,1.0
2021-01-14,215.91,217.46,212.74,213.02,212.532619709,29346737,0.0000,1.0
2021-01-13,214.02,216.76,213.9266,216.34,215.845023697,20087080,0.0000,1.0
2021-01-12,216.5,217.1,213.3202,214.93,214.438249714,23148341,0.0000,1.0
2021-01-11,218.47,218.91,216.73,217.49,216.992392548,23047029,0.0000,1.0
2021-01-08,218.68,220.58,217.0261,219.62,219.117519202,22956206,0.0000,1.0
2021-01-07,214.04,219.34,213.71,218.29,217.790562183,27694480,0.0000,1.0
2021-01-06,212.17,216.4899,211.94,212.25,211.764381435,35930653,0.0000,1.0
2021-01-05,217.26,218.52,215.7,217.9,217.401454486,23822953,0.0000,1.0
2021-01-04,222.53,223.0,214.81,217.69,217.191934957,37130139,0.0000,1.0
2020-12-31,221.7,223.0,219.68,222.42,221.911112927,20942132,0.0000,1.0
2020-12-30,225.23,225.63,221.47,221.68,221.172806014,20272337,0.0000,1.0
2020-12-29,226.31,227.18,223.58,224.15,223.637154764,17403213,0.0000,1.0
2020-12-28,224.45,226.03,223.02,224.96,224.44530152,17762701,0.0000,1.0
2020-12-24,221.42,223.61,221.2,222.75,222.240357902,10550572,0.0000,1.0
2020-12-23,223.11,223.5589,220.8,221.02,220.514316065,18699638,0.0000,1.0
2020-12-22,222.69,225.63,221.85,223.94,223.427635235,22643397,0.0000,1.0
2020-12-21,217.55,224.0,217.2801,222.59,222.080723975,37181886,0.0000,1.0
2020-12-18,218.59,219.69,216.02,218.59,218.089875797,63354922,0.0000,1.0
2020-12-17,219.87,220.89,217.92,219.42,218.917976794,32515784,0.0000,1.0
2020-12-16,214.75,220.11,214.72,219.28,218.778297107,35023253,0.0000,1.0
2020-12-15,215.165,215.42,212.24,214.13,213.640080078,27018106,0.0000,1.0
2020-12-14,213.1,216.21,212.88,214.2,213.709919922,28798379,0.0000,1.0
2020-12-11,210.05,213.32,209.11,213.26,212.7720706,30979440,0.0000,1.0
2020-12-10,211.77,213.08,210.36,210.52,210.038339598,26467017,0.0000,1.0
2020-12-09,215.16,215.225,211.214,211.8,211.315411015,32440603,0.0000,1.0
2020-12-08,213.97,216.95,212.89,216.01,215.515778722,23284094,0.0000,1.0
2020-12-07,214.37,215.54,212.99,214.29,213.799714006,24619997,0.0000,1.0
2020-12-04,214.22,215.38,213.18,214.36,213.869553849,24666039,0.0000,1.0
2020-12-03,214.61,216.3757,213.65,214.24,213.749828403,25120922,0.0000,1.0
2020-12-02,214.88,215.47,212.8,215.37,214.877243014,23724509,0.0000,1.0
2020-12-01,214.51,217.32,213.35,216.21,215.715321131,30498026,0.0000,1.0
2020-11-30,214.1,214.76,210.835,214.07,213.580217356,33064753,0.0000,1.0
2020-11-27,214.85,216.27,214.04,215.23,214.737563327,14512213,0.0000,1.0
2020-11-25,215.11,215.29,212.46,213.87,213.380674947,21012887,0.0000,1.0
2020-11-24,209.59,214.25,208.86,213.86,213.370697826,33830438,0.0000,1.0
2020-11-23,210.95,212.29,208.16,210.11,209.62927766,25683507,0.0000,1.0
2020-11-20,212.2,213.285,210.0,210.39,209.908637032,22843119,0.0000,1.0
2020-11-19,211.38,213.03,209.93,212.42,211.933992482,24792746,0.0000,1.0
2020-11-18,213.65,215.17,210.93,211.08,210.597058343,28372789,0.5600,1.0
2020-11-17,216.1,217.68,214.08,214.46,213.403161653,24154112,0.0000,1.0
2020-11-16,214.87,217.74,214.52,217.23,216.159511358,24953344,0.0000,1.0
2020-11-13,216.36,217.42,214.16,216.51,215.443059449,18630307,0.0000,1.0
2020-11-12,217.21,219.11,214.46,215.44,214.378332307,21616115,0.0000,1.0
2020-11-11,212.39,218.04,212.2,216.55,215.482862333,29440788,0.0000,1.0
2020-11-10,214.5,216.5,209.72,211.01,209.970162923,44045120,0.0000,1.0
2020-11-09,224.435,228.12,217.88,218.39,217.313794989,44394950,0.0000,1.0
2020-11-06,222.26,224.36,218.03,223.72,222.617529259,25231895,0.0000,1.0";

            using var client = new AlphaVantageClient(new MockHandler(csv), string.Empty, int.MaxValue);
            var candles = await client.DailyAdjustedAsync("MSFT", OutputSize.Compact, CancellationToken.None);
            Assert.AreEqual(100, candles.Length);

            // 2021-04-01,238.47,242.84,238.0501,242.35,242.35,30337982,0.0000,1.0
            Assert.AreEqual(
                new AdjustedCandle(
                    new DateTimeOffset(2021, 04, 01, 0, 0, 0, 0, TimeSpan.Zero),
                    238.47f,
                    242.84f,
                    238.0501f,
                    242.35f,
                    242.35f,
                    30337982,
                    0,
                    1),
                candles[0]);

            // 2020-11-06,222.26,224.36,218.03,223.72,222.617529259,25231895,0.0000,1.0
            Assert.AreEqual(
                new AdjustedCandle(
                    new DateTimeOffset(2020, 11, 06, 0, 0, 0, 0, TimeSpan.Zero),
                    222.26f,
                    224.36f,
                    218.03f,
                    223.72f,
                    222.617529259f,
                    25231895,
                    0,
                    1),
                candles[99]);
        }

        [Explicit("Hits endpoint.")]
        [Test]
        public static async Task EarningsAsync()
        {
            using var client = new AlphaVantageClient(new HttpClientHandler(), ClientSettings!.ApiKey!, ClientSettings.MaxCallsPerMinute);
            var earnings = await client.EarningsAsync("MSFT").ConfigureAwait(false);
            CollectionAssert.IsNotEmpty(earnings.AnnualEarnings);
            CollectionAssert.IsNotEmpty(earnings.QuarterlyEarnings);
        }

        [Test]
        public static async Task EarningsAsyncUsingMock()
        {
            const string json = @"{
    ""symbol"": ""IBM"",
    ""annualEarnings"": [
        {
            ""fiscalDateEnding"": ""2021-03-31"",
            ""reportedEPS"": ""1.77""
        },
        {
            ""fiscalDateEnding"": ""2020-12-31"",
            ""reportedEPS"": ""8.67""
        },
        {
            ""fiscalDateEnding"": ""2019-12-31"",
            ""reportedEPS"": ""12.81""
        },
        {
            ""fiscalDateEnding"": ""2018-12-31"",
            ""reportedEPS"": ""13.82""
        },
        {
            ""fiscalDateEnding"": ""2017-12-31"",
            ""reportedEPS"": ""13.83""
        },
        {
            ""fiscalDateEnding"": ""2016-12-31"",
            ""reportedEPS"": ""13.6""
        },
        {
            ""fiscalDateEnding"": ""2015-12-31"",
            ""reportedEPS"": ""14.93""
        },
        {
            ""fiscalDateEnding"": ""2014-12-31"",
            ""reportedEPS"": ""16.27""
        },
        {
            ""fiscalDateEnding"": ""2013-12-31"",
            ""reportedEPS"": ""17.03""
        },
        {
            ""fiscalDateEnding"": ""2012-12-31"",
            ""reportedEPS"": ""15.3""
        },
        {
            ""fiscalDateEnding"": ""2011-12-31"",
            ""reportedEPS"": ""13.49""
        },
        {
            ""fiscalDateEnding"": ""2010-12-31"",
            ""reportedEPS"": ""11.58""
        },
        {
            ""fiscalDateEnding"": ""2009-12-31"",
            ""reportedEPS"": ""10.01""
        },
        {
            ""fiscalDateEnding"": ""2008-12-31"",
            ""reportedEPS"": ""8.96""
        },
        {
            ""fiscalDateEnding"": ""2007-12-31"",
            ""reportedEPS"": ""7.19""
        },
        {
            ""fiscalDateEnding"": ""2006-12-31"",
            ""reportedEPS"": ""6.09""
        },
        {
            ""fiscalDateEnding"": ""2005-12-31"",
            ""reportedEPS"": ""5.34""
        },
        {
            ""fiscalDateEnding"": ""2004-12-31"",
            ""reportedEPS"": ""5.07""
        },
        {
            ""fiscalDateEnding"": ""2003-12-31"",
            ""reportedEPS"": ""4.34""
        },
        {
            ""fiscalDateEnding"": ""2002-12-31"",
            ""reportedEPS"": ""3.9""
        },
        {
            ""fiscalDateEnding"": ""2001-12-31"",
            ""reportedEPS"": ""4.44""
        },
        {
            ""fiscalDateEnding"": ""2000-12-31"",
            ""reportedEPS"": ""4.45""
        },
        {
            ""fiscalDateEnding"": ""1999-12-31"",
            ""reportedEPS"": ""3.71""
        },
        {
            ""fiscalDateEnding"": ""1998-12-31"",
            ""reportedEPS"": ""3.32""
        },
        {
            ""fiscalDateEnding"": ""1997-12-31"",
            ""reportedEPS"": ""3.09""
        },
        {
            ""fiscalDateEnding"": ""1996-12-31"",
            ""reportedEPS"": ""2.77""
        }
    ],
    ""quarterlyEarnings"": [
        {
            ""fiscalDateEnding"": ""2021-03-31"",
            ""reportedDate"": ""2021-04-19"",
            ""reportedEPS"": ""1.77"",
            ""estimatedEPS"": ""1.6524"",
            ""surprise"": ""0.1176"",
            ""surprisePercentage"": ""7.1169""
        },
        {
            ""fiscalDateEnding"": ""2020-12-31"",
            ""reportedDate"": ""2021-01-21"",
            ""reportedEPS"": ""2.07"",
            ""estimatedEPS"": ""1.8753"",
            ""surprise"": ""0.1947"",
            ""surprisePercentage"": ""10.3823""
        },
        {
            ""fiscalDateEnding"": ""2020-09-30"",
            ""reportedDate"": ""2020-10-19"",
            ""reportedEPS"": ""2.58"",
            ""estimatedEPS"": ""2.579"",
            ""surprise"": ""0.001"",
            ""surprisePercentage"": ""0.0388""
        },
        {
            ""fiscalDateEnding"": ""2020-06-30"",
            ""reportedDate"": ""2020-07-20"",
            ""reportedEPS"": ""2.18"",
            ""estimatedEPS"": ""2.0851"",
            ""surprise"": ""0.0949"",
            ""surprisePercentage"": ""4.5513""
        },
        {
            ""fiscalDateEnding"": ""2020-03-31"",
            ""reportedDate"": ""2020-04-20"",
            ""reportedEPS"": ""1.84"",
            ""estimatedEPS"": ""1.801"",
            ""surprise"": ""0.039"",
            ""surprisePercentage"": ""2.1655""
        },
        {
            ""fiscalDateEnding"": ""2019-12-31"",
            ""reportedDate"": ""2020-01-21"",
            ""reportedEPS"": ""4.71"",
            ""estimatedEPS"": ""4.6937"",
            ""surprise"": ""0.0163"",
            ""surprisePercentage"": ""0.3473""
        },
        {
            ""fiscalDateEnding"": ""2019-09-30"",
            ""reportedDate"": ""2019-10-16"",
            ""reportedEPS"": ""2.68"",
            ""estimatedEPS"": ""2.6601"",
            ""surprise"": ""0.0199"",
            ""surprisePercentage"": ""0.7481""
        },
        {
            ""fiscalDateEnding"": ""2019-06-30"",
            ""reportedDate"": ""2019-07-17"",
            ""reportedEPS"": ""3.17"",
            ""estimatedEPS"": ""3.0722"",
            ""surprise"": ""0.0978"",
            ""surprisePercentage"": ""3.1834""
        },
        {
            ""fiscalDateEnding"": ""2019-03-31"",
            ""reportedDate"": ""2019-04-16"",
            ""reportedEPS"": ""2.25"",
            ""estimatedEPS"": ""2.2362"",
            ""surprise"": ""0.0138"",
            ""surprisePercentage"": ""0.6171""
        },
        {
            ""fiscalDateEnding"": ""2018-12-31"",
            ""reportedDate"": ""2019-01-22"",
            ""reportedEPS"": ""4.87"",
            ""estimatedEPS"": ""4.8193"",
            ""surprise"": ""0.0507"",
            ""surprisePercentage"": ""1.052""
        },
        {
            ""fiscalDateEnding"": ""2018-09-30"",
            ""reportedDate"": ""2018-10-16"",
            ""reportedEPS"": ""3.42"",
            ""estimatedEPS"": ""3.4017"",
            ""surprise"": ""0.0183"",
            ""surprisePercentage"": ""0.538""
        },
        {
            ""fiscalDateEnding"": ""2018-06-30"",
            ""reportedDate"": ""2018-07-18"",
            ""reportedEPS"": ""3.08"",
            ""estimatedEPS"": ""3.0381"",
            ""surprise"": ""0.0419"",
            ""surprisePercentage"": ""1.3792""
        },
        {
            ""fiscalDateEnding"": ""2018-03-31"",
            ""reportedDate"": ""2018-04-17"",
            ""reportedEPS"": ""2.45"",
            ""estimatedEPS"": ""2.4162"",
            ""surprise"": ""0.0338"",
            ""surprisePercentage"": ""1.3989""
        },
        {
            ""fiscalDateEnding"": ""2017-12-31"",
            ""reportedDate"": ""2018-01-18"",
            ""reportedEPS"": ""5.18"",
            ""estimatedEPS"": ""5.1676"",
            ""surprise"": ""0.0124"",
            ""surprisePercentage"": ""0.24""
        },
        {
            ""fiscalDateEnding"": ""2017-09-30"",
            ""reportedDate"": ""2017-10-17"",
            ""reportedEPS"": ""3.3"",
            ""estimatedEPS"": ""3.2761"",
            ""surprise"": ""0.0239"",
            ""surprisePercentage"": ""0.7295""
        },
        {
            ""fiscalDateEnding"": ""2017-06-30"",
            ""reportedDate"": ""2017-07-18"",
            ""reportedEPS"": ""2.97"",
            ""estimatedEPS"": ""2.7439"",
            ""surprise"": ""0.2261"",
            ""surprisePercentage"": ""8.2401""
        },
        {
            ""fiscalDateEnding"": ""2017-03-31"",
            ""reportedDate"": ""2017-04-18"",
            ""reportedEPS"": ""2.38"",
            ""estimatedEPS"": ""2.3475"",
            ""surprise"": ""0.0325"",
            ""surprisePercentage"": ""1.3845""
        },
        {
            ""fiscalDateEnding"": ""2016-12-31"",
            ""reportedDate"": ""2017-01-19"",
            ""reportedEPS"": ""5.01"",
            ""estimatedEPS"": ""4.8797"",
            ""surprise"": ""0.1303"",
            ""surprisePercentage"": ""2.6702""
        },
        {
            ""fiscalDateEnding"": ""2016-09-30"",
            ""reportedDate"": ""2016-10-17"",
            ""reportedEPS"": ""3.29"",
            ""estimatedEPS"": ""3.233"",
            ""surprise"": ""0.057"",
            ""surprisePercentage"": ""1.7631""
        },
        {
            ""fiscalDateEnding"": ""2016-06-30"",
            ""reportedDate"": ""2016-07-18"",
            ""reportedEPS"": ""2.95"",
            ""estimatedEPS"": ""2.88"",
            ""surprise"": ""0.07"",
            ""surprisePercentage"": ""2.4306""
        },
        {
            ""fiscalDateEnding"": ""2016-03-31"",
            ""reportedDate"": ""2016-04-18"",
            ""reportedEPS"": ""2.35"",
            ""estimatedEPS"": ""2.1717"",
            ""surprise"": ""0.1783"",
            ""surprisePercentage"": ""8.2102""
        },
        {
            ""fiscalDateEnding"": ""2015-12-31"",
            ""reportedDate"": ""2016-01-19"",
            ""reportedEPS"": ""4.84"",
            ""estimatedEPS"": ""4.8127"",
            ""surprise"": ""0.0273"",
            ""surprisePercentage"": ""0.5672""
        },
        {
            ""fiscalDateEnding"": ""2015-09-30"",
            ""reportedDate"": ""2015-10-19"",
            ""reportedEPS"": ""3.34"",
            ""estimatedEPS"": ""3.3"",
            ""surprise"": ""0.04"",
            ""surprisePercentage"": ""1.2121""
        },
        {
            ""fiscalDateEnding"": ""2015-06-30"",
            ""reportedDate"": ""2015-07-20"",
            ""reportedEPS"": ""3.84"",
            ""estimatedEPS"": ""3.78"",
            ""surprise"": ""0.06"",
            ""surprisePercentage"": ""1.5873""
        },
        {
            ""fiscalDateEnding"": ""2015-03-31"",
            ""reportedDate"": ""2015-04-20"",
            ""reportedEPS"": ""2.91"",
            ""estimatedEPS"": ""2.8"",
            ""surprise"": ""0.11"",
            ""surprisePercentage"": ""3.9286""
        },
        {
            ""fiscalDateEnding"": ""2014-12-31"",
            ""reportedDate"": ""2015-01-20"",
            ""reportedEPS"": ""5.81"",
            ""estimatedEPS"": ""5.41"",
            ""surprise"": ""0.4"",
            ""surprisePercentage"": ""7.3937""
        },
        {
            ""fiscalDateEnding"": ""2014-09-30"",
            ""reportedDate"": ""2014-10-20"",
            ""reportedEPS"": ""3.68"",
            ""estimatedEPS"": ""4.32"",
            ""surprise"": ""-0.64"",
            ""surprisePercentage"": ""-14.8148""
        },
        {
            ""fiscalDateEnding"": ""2014-06-30"",
            ""reportedDate"": ""2014-07-17"",
            ""reportedEPS"": ""4.32"",
            ""estimatedEPS"": ""4.29"",
            ""surprise"": ""0.03"",
            ""surprisePercentage"": ""0.6993""
        },
        {
            ""fiscalDateEnding"": ""2014-03-31"",
            ""reportedDate"": ""2014-04-16"",
            ""reportedEPS"": ""2.46"",
            ""estimatedEPS"": ""2.54"",
            ""surprise"": ""-0.08"",
            ""surprisePercentage"": ""-3.1496""
        },
        {
            ""fiscalDateEnding"": ""2013-12-31"",
            ""reportedDate"": ""2014-01-21"",
            ""reportedEPS"": ""6.13"",
            ""estimatedEPS"": ""5.99"",
            ""surprise"": ""0.14"",
            ""surprisePercentage"": ""2.3372""
        },
        {
            ""fiscalDateEnding"": ""2013-09-30"",
            ""reportedDate"": ""2013-10-16"",
            ""reportedEPS"": ""3.99"",
            ""estimatedEPS"": ""3.96"",
            ""surprise"": ""0.03"",
            ""surprisePercentage"": ""0.7576""
        },
        {
            ""fiscalDateEnding"": ""2013-06-30"",
            ""reportedDate"": ""2013-07-17"",
            ""reportedEPS"": ""3.91"",
            ""estimatedEPS"": ""3.77"",
            ""surprise"": ""0.14"",
            ""surprisePercentage"": ""3.7135""
        },
        {
            ""fiscalDateEnding"": ""2013-03-31"",
            ""reportedDate"": ""2013-04-18"",
            ""reportedEPS"": ""3"",
            ""estimatedEPS"": ""3.05"",
            ""surprise"": ""-0.05"",
            ""surprisePercentage"": ""-1.6393""
        },
        {
            ""fiscalDateEnding"": ""2012-12-31"",
            ""reportedDate"": ""2013-01-22"",
            ""reportedEPS"": ""5.39"",
            ""estimatedEPS"": ""5.25"",
            ""surprise"": ""0.14"",
            ""surprisePercentage"": ""2.6667""
        },
        {
            ""fiscalDateEnding"": ""2012-09-30"",
            ""reportedDate"": ""2012-10-16"",
            ""reportedEPS"": ""3.62"",
            ""estimatedEPS"": ""3.61"",
            ""surprise"": ""0.01"",
            ""surprisePercentage"": ""0.277""
        },
        {
            ""fiscalDateEnding"": ""2012-06-30"",
            ""reportedDate"": ""2012-07-18"",
            ""reportedEPS"": ""3.51"",
            ""estimatedEPS"": ""3.42"",
            ""surprise"": ""0.09"",
            ""surprisePercentage"": ""2.6316""
        },
        {
            ""fiscalDateEnding"": ""2012-03-31"",
            ""reportedDate"": ""2012-04-17"",
            ""reportedEPS"": ""2.78"",
            ""estimatedEPS"": ""2.65"",
            ""surprise"": ""0.13"",
            ""surprisePercentage"": ""4.9057""
        },
        {
            ""fiscalDateEnding"": ""2011-12-31"",
            ""reportedDate"": ""2012-01-19"",
            ""reportedEPS"": ""4.71"",
            ""estimatedEPS"": ""4.62"",
            ""surprise"": ""0.09"",
            ""surprisePercentage"": ""1.9481""
        },
        {
            ""fiscalDateEnding"": ""2011-09-30"",
            ""reportedDate"": ""2011-10-17"",
            ""reportedEPS"": ""3.28"",
            ""estimatedEPS"": ""3.22"",
            ""surprise"": ""0.06"",
            ""surprisePercentage"": ""1.8634""
        },
        {
            ""fiscalDateEnding"": ""2011-06-30"",
            ""reportedDate"": ""2011-07-18"",
            ""reportedEPS"": ""3.09"",
            ""estimatedEPS"": ""3.03"",
            ""surprise"": ""0.06"",
            ""surprisePercentage"": ""1.9802""
        },
        {
            ""fiscalDateEnding"": ""2011-03-31"",
            ""reportedDate"": ""2011-04-19"",
            ""reportedEPS"": ""2.41"",
            ""estimatedEPS"": ""2.3"",
            ""surprise"": ""0.11"",
            ""surprisePercentage"": ""4.7826""
        },
        {
            ""fiscalDateEnding"": ""2010-12-31"",
            ""reportedDate"": ""2011-01-18"",
            ""reportedEPS"": ""4.18"",
            ""estimatedEPS"": ""4.08"",
            ""surprise"": ""0.1"",
            ""surprisePercentage"": ""2.451""
        },
        {
            ""fiscalDateEnding"": ""2010-09-30"",
            ""reportedDate"": ""2010-10-18"",
            ""reportedEPS"": ""2.82"",
            ""estimatedEPS"": ""2.75"",
            ""surprise"": ""0.07"",
            ""surprisePercentage"": ""2.5455""
        },
        {
            ""fiscalDateEnding"": ""2010-06-30"",
            ""reportedDate"": ""2010-07-19"",
            ""reportedEPS"": ""2.61"",
            ""estimatedEPS"": ""2.58"",
            ""surprise"": ""0.03"",
            ""surprisePercentage"": ""1.1628""
        },
        {
            ""fiscalDateEnding"": ""2010-03-31"",
            ""reportedDate"": ""2010-04-19"",
            ""reportedEPS"": ""1.97"",
            ""estimatedEPS"": ""1.93"",
            ""surprise"": ""0.04"",
            ""surprisePercentage"": ""2.0725""
        },
        {
            ""fiscalDateEnding"": ""2009-12-31"",
            ""reportedDate"": ""2010-01-19"",
            ""reportedEPS"": ""3.59"",
            ""estimatedEPS"": ""3.47"",
            ""surprise"": ""0.12"",
            ""surprisePercentage"": ""3.4582""
        },
        {
            ""fiscalDateEnding"": ""2009-09-30"",
            ""reportedDate"": ""2009-10-15"",
            ""reportedEPS"": ""2.4"",
            ""estimatedEPS"": ""2.38"",
            ""surprise"": ""0.02"",
            ""surprisePercentage"": ""0.8403""
        },
        {
            ""fiscalDateEnding"": ""2009-06-30"",
            ""reportedDate"": ""2009-07-16"",
            ""reportedEPS"": ""2.32"",
            ""estimatedEPS"": ""2.02"",
            ""surprise"": ""0.3"",
            ""surprisePercentage"": ""14.8515""
        },
        {
            ""fiscalDateEnding"": ""2009-03-31"",
            ""reportedDate"": ""2009-04-20"",
            ""reportedEPS"": ""1.7"",
            ""estimatedEPS"": ""1.66"",
            ""surprise"": ""0.04"",
            ""surprisePercentage"": ""2.4096""
        },
        {
            ""fiscalDateEnding"": ""2008-12-31"",
            ""reportedDate"": ""2009-01-20"",
            ""reportedEPS"": ""3.28"",
            ""estimatedEPS"": ""3.03"",
            ""surprise"": ""0.25"",
            ""surprisePercentage"": ""8.2508""
        },
        {
            ""fiscalDateEnding"": ""2008-09-30"",
            ""reportedDate"": ""2008-10-16"",
            ""reportedEPS"": ""2.05"",
            ""estimatedEPS"": ""2.03"",
            ""surprise"": ""0.02"",
            ""surprisePercentage"": ""0.9852""
        },
        {
            ""fiscalDateEnding"": ""2008-06-30"",
            ""reportedDate"": ""2008-07-17"",
            ""reportedEPS"": ""1.98"",
            ""estimatedEPS"": ""1.82"",
            ""surprise"": ""0.16"",
            ""surprisePercentage"": ""8.7912""
        },
        {
            ""fiscalDateEnding"": ""2008-03-31"",
            ""reportedDate"": ""2008-04-16"",
            ""reportedEPS"": ""1.65"",
            ""estimatedEPS"": ""1.45"",
            ""surprise"": ""0.2"",
            ""surprisePercentage"": ""13.7931""
        },
        {
            ""fiscalDateEnding"": ""2007-12-31"",
            ""reportedDate"": ""2008-01-17"",
            ""reportedEPS"": ""2.8"",
            ""estimatedEPS"": ""2.68"",
            ""surprise"": ""0.12"",
            ""surprisePercentage"": ""4.4776""
        },
        {
            ""fiscalDateEnding"": ""2007-09-30"",
            ""reportedDate"": ""2007-10-16"",
            ""reportedEPS"": ""1.68"",
            ""estimatedEPS"": ""1.67"",
            ""surprise"": ""0.01"",
            ""surprisePercentage"": ""0.5988""
        },
        {
            ""fiscalDateEnding"": ""2007-06-30"",
            ""reportedDate"": ""2007-07-18"",
            ""reportedEPS"": ""1.5"",
            ""estimatedEPS"": ""1.47"",
            ""surprise"": ""0.03"",
            ""surprisePercentage"": ""2.0408""
        },
        {
            ""fiscalDateEnding"": ""2007-03-31"",
            ""reportedDate"": ""2007-04-17"",
            ""reportedEPS"": ""1.21"",
            ""estimatedEPS"": ""1.21"",
            ""surprise"": ""0"",
            ""surprisePercentage"": ""0""
        },
        {
            ""fiscalDateEnding"": ""2006-12-31"",
            ""reportedDate"": ""2007-01-18"",
            ""reportedEPS"": ""2.26"",
            ""estimatedEPS"": ""2.19"",
            ""surprise"": ""0.07"",
            ""surprisePercentage"": ""3.1963""
        },
        {
            ""fiscalDateEnding"": ""2006-09-30"",
            ""reportedDate"": ""2006-10-17"",
            ""reportedEPS"": ""1.45"",
            ""estimatedEPS"": ""1.35"",
            ""surprise"": ""0.1"",
            ""surprisePercentage"": ""7.4074""
        },
        {
            ""fiscalDateEnding"": ""2006-06-30"",
            ""reportedDate"": ""2006-07-18"",
            ""reportedEPS"": ""1.3"",
            ""estimatedEPS"": ""1.29"",
            ""surprise"": ""0.01"",
            ""surprisePercentage"": ""0.7752""
        },
        {
            ""fiscalDateEnding"": ""2006-03-31"",
            ""reportedDate"": ""2006-04-18"",
            ""reportedEPS"": ""1.08"",
            ""estimatedEPS"": ""1.05"",
            ""surprise"": ""0.03"",
            ""surprisePercentage"": ""2.8571""
        },
        {
            ""fiscalDateEnding"": ""2005-12-31"",
            ""reportedDate"": ""2006-01-17"",
            ""reportedEPS"": ""2.11"",
            ""estimatedEPS"": ""1.94"",
            ""surprise"": ""0.17"",
            ""surprisePercentage"": ""8.7629""
        },
        {
            ""fiscalDateEnding"": ""2005-09-30"",
            ""reportedDate"": ""2005-10-17"",
            ""reportedEPS"": ""1.26"",
            ""estimatedEPS"": ""1.13"",
            ""surprise"": ""0.13"",
            ""surprisePercentage"": ""11.5044""
        },
        {
            ""fiscalDateEnding"": ""2005-06-30"",
            ""reportedDate"": ""2005-07-18"",
            ""reportedEPS"": ""1.12"",
            ""estimatedEPS"": ""1.03"",
            ""surprise"": ""0.09"",
            ""surprisePercentage"": ""8.7379""
        },
        {
            ""fiscalDateEnding"": ""2005-03-31"",
            ""reportedDate"": ""2005-04-14"",
            ""reportedEPS"": ""0.85"",
            ""estimatedEPS"": ""0.9"",
            ""surprise"": ""-0.05"",
            ""surprisePercentage"": ""-5.5556""
        },
        {
            ""fiscalDateEnding"": ""2004-12-31"",
            ""reportedDate"": ""2005-01-18"",
            ""reportedEPS"": ""1.81"",
            ""estimatedEPS"": ""1.76"",
            ""surprise"": ""0.05"",
            ""surprisePercentage"": ""2.8409""
        },
        {
            ""fiscalDateEnding"": ""2004-09-30"",
            ""reportedDate"": ""2004-10-18"",
            ""reportedEPS"": ""1.17"",
            ""estimatedEPS"": ""1.14"",
            ""surprise"": ""0.03"",
            ""surprisePercentage"": ""2.6316""
        },
        {
            ""fiscalDateEnding"": ""2004-06-30"",
            ""reportedDate"": ""2004-07-15"",
            ""reportedEPS"": ""1.16"",
            ""estimatedEPS"": ""1.12"",
            ""surprise"": ""0.04"",
            ""surprisePercentage"": ""3.5714""
        },
        {
            ""fiscalDateEnding"": ""2004-03-31"",
            ""reportedDate"": ""2004-04-15"",
            ""reportedEPS"": ""0.93"",
            ""estimatedEPS"": ""0.93"",
            ""surprise"": ""0"",
            ""surprisePercentage"": ""0""
        },
        {
            ""fiscalDateEnding"": ""2003-12-31"",
            ""reportedDate"": ""2004-01-15"",
            ""reportedEPS"": ""1.56"",
            ""estimatedEPS"": ""1.5"",
            ""surprise"": ""0.06"",
            ""surprisePercentage"": ""4""
        },
        {
            ""fiscalDateEnding"": ""2003-09-30"",
            ""reportedDate"": ""2003-10-15"",
            ""reportedEPS"": ""1.02"",
            ""estimatedEPS"": ""1.02"",
            ""surprise"": ""0"",
            ""surprisePercentage"": ""0""
        },
        {
            ""fiscalDateEnding"": ""2003-06-30"",
            ""reportedDate"": ""2003-07-16"",
            ""reportedEPS"": ""0.97"",
            ""estimatedEPS"": ""0.98"",
            ""surprise"": ""-0.01"",
            ""surprisePercentage"": ""-1.0204""
        },
        {
            ""fiscalDateEnding"": ""2003-03-31"",
            ""reportedDate"": ""2003-04-14"",
            ""reportedEPS"": ""0.79"",
            ""estimatedEPS"": ""0.8"",
            ""surprise"": ""-0.01"",
            ""surprisePercentage"": ""-1.25""
        },
        {
            ""fiscalDateEnding"": ""2002-12-31"",
            ""reportedDate"": ""2003-01-16"",
            ""reportedEPS"": ""1.34"",
            ""estimatedEPS"": ""1.3"",
            ""surprise"": ""0.04"",
            ""surprisePercentage"": ""3.0769""
        },
        {
            ""fiscalDateEnding"": ""2002-09-30"",
            ""reportedDate"": ""2002-10-16"",
            ""reportedEPS"": ""0.99"",
            ""estimatedEPS"": ""0.96"",
            ""surprise"": ""0.03"",
            ""surprisePercentage"": ""3.125""
        },
        {
            ""fiscalDateEnding"": ""2002-06-30"",
            ""reportedDate"": ""2002-07-17"",
            ""reportedEPS"": ""0.89"",
            ""estimatedEPS"": ""0.83"",
            ""surprise"": ""0.06"",
            ""surprisePercentage"": ""7.2289""
        },
        {
            ""fiscalDateEnding"": ""2002-03-31"",
            ""reportedDate"": ""2002-04-17"",
            ""reportedEPS"": ""0.68"",
            ""estimatedEPS"": ""0.68"",
            ""surprise"": ""0"",
            ""surprisePercentage"": ""0""
        },
        {
            ""fiscalDateEnding"": ""2001-12-31"",
            ""reportedDate"": ""2002-01-17"",
            ""reportedEPS"": ""1.33"",
            ""estimatedEPS"": ""1.32"",
            ""surprise"": ""0.01"",
            ""surprisePercentage"": ""0.7576""
        },
        {
            ""fiscalDateEnding"": ""2001-09-30"",
            ""reportedDate"": ""2001-10-16"",
            ""reportedEPS"": ""0.9"",
            ""estimatedEPS"": ""0.89"",
            ""surprise"": ""0.01"",
            ""surprisePercentage"": ""1.1236""
        },
        {
            ""fiscalDateEnding"": ""2001-06-30"",
            ""reportedDate"": ""2001-07-18"",
            ""reportedEPS"": ""1.21"",
            ""estimatedEPS"": ""1.15"",
            ""surprise"": ""0.06"",
            ""surprisePercentage"": ""5.2174""
        },
        {
            ""fiscalDateEnding"": ""2001-03-31"",
            ""reportedDate"": ""2001-04-18"",
            ""reportedEPS"": ""1"",
            ""estimatedEPS"": ""0.98"",
            ""surprise"": ""0.02"",
            ""surprisePercentage"": ""2.0408""
        },
        {
            ""fiscalDateEnding"": ""2000-12-31"",
            ""reportedDate"": ""2001-01-17"",
            ""reportedEPS"": ""1.48"",
            ""estimatedEPS"": ""1.46"",
            ""surprise"": ""0.02"",
            ""surprisePercentage"": ""1.3699""
        },
        {
            ""fiscalDateEnding"": ""2000-09-30"",
            ""reportedDate"": ""2000-10-17"",
            ""reportedEPS"": ""1.08"",
            ""estimatedEPS"": ""1.08"",
            ""surprise"": ""0"",
            ""surprisePercentage"": ""0""
        },
        {
            ""fiscalDateEnding"": ""2000-06-30"",
            ""reportedDate"": ""2000-07-19"",
            ""reportedEPS"": ""1.06"",
            ""estimatedEPS"": ""1"",
            ""surprise"": ""0.06"",
            ""surprisePercentage"": ""6""
        },
        {
            ""fiscalDateEnding"": ""2000-03-31"",
            ""reportedDate"": ""2000-04-18"",
            ""reportedEPS"": ""0.83"",
            ""estimatedEPS"": ""0.78"",
            ""surprise"": ""0.05"",
            ""surprisePercentage"": ""6.4103""
        },
        {
            ""fiscalDateEnding"": ""1999-12-31"",
            ""reportedDate"": ""2000-01-19"",
            ""reportedEPS"": ""1.12"",
            ""estimatedEPS"": ""1.06"",
            ""surprise"": ""0.06"",
            ""surprisePercentage"": ""5.6604""
        },
        {
            ""fiscalDateEnding"": ""1999-09-30"",
            ""reportedDate"": ""1999-10-20"",
            ""reportedEPS"": ""0.9"",
            ""estimatedEPS"": ""0.89"",
            ""surprise"": ""0.01"",
            ""surprisePercentage"": ""1.1236""
        },
        {
            ""fiscalDateEnding"": ""1999-06-30"",
            ""reportedDate"": ""1999-07-19"",
            ""reportedEPS"": ""0.91"",
            ""estimatedEPS"": ""0.88"",
            ""surprise"": ""0.03"",
            ""surprisePercentage"": ""3.4091""
        },
        {
            ""fiscalDateEnding"": ""1999-03-31"",
            ""reportedDate"": ""1999-04-21"",
            ""reportedEPS"": ""0.78"",
            ""estimatedEPS"": ""0.7"",
            ""surprise"": ""0.08"",
            ""surprisePercentage"": ""11.4286""
        },
        {
            ""fiscalDateEnding"": ""1998-12-31"",
            ""reportedDate"": ""1999-01-21"",
            ""reportedEPS"": ""1.24"",
            ""estimatedEPS"": ""1.22"",
            ""surprise"": ""0.02"",
            ""surprisePercentage"": ""1.6393""
        },
        {
            ""fiscalDateEnding"": ""1998-09-30"",
            ""reportedDate"": ""1998-10-20"",
            ""reportedEPS"": ""0.78"",
            ""estimatedEPS"": ""0.77"",
            ""surprise"": ""0.01"",
            ""surprisePercentage"": ""1.2987""
        },
        {
            ""fiscalDateEnding"": ""1998-06-30"",
            ""reportedDate"": ""1998-07-20"",
            ""reportedEPS"": ""0.77"",
            ""estimatedEPS"": ""0.75"",
            ""surprise"": ""0.02"",
            ""surprisePercentage"": ""2.6667""
        },
        {
            ""fiscalDateEnding"": ""1998-03-31"",
            ""reportedDate"": ""1998-04-20"",
            ""reportedEPS"": ""0.53"",
            ""estimatedEPS"": ""0.53"",
            ""surprise"": ""0"",
            ""surprisePercentage"": ""0""
        },
        {
            ""fiscalDateEnding"": ""1997-12-31"",
            ""reportedDate"": ""1998-01-20"",
            ""reportedEPS"": ""1.08"",
            ""estimatedEPS"": ""1.07"",
            ""surprise"": ""0.01"",
            ""surprisePercentage"": ""0.9346""
        },
        {
            ""fiscalDateEnding"": ""1997-09-30"",
            ""reportedDate"": ""1997-10-20"",
            ""reportedEPS"": ""0.69"",
            ""estimatedEPS"": ""0.68"",
            ""surprise"": ""0.01"",
            ""surprisePercentage"": ""1.4706""
        },
        {
            ""fiscalDateEnding"": ""1997-06-30"",
            ""reportedDate"": ""1997-07-21"",
            ""reportedEPS"": ""0.73"",
            ""estimatedEPS"": ""0.71"",
            ""surprise"": ""0.02"",
            ""surprisePercentage"": ""2.8169""
        },
        {
            ""fiscalDateEnding"": ""1997-03-31"",
            ""reportedDate"": ""1997-04-23"",
            ""reportedEPS"": ""0.59"",
            ""estimatedEPS"": ""0.58"",
            ""surprise"": ""0.01"",
            ""surprisePercentage"": ""1.7241""
        },
        {
            ""fiscalDateEnding"": ""1996-12-31"",
            ""reportedDate"": ""1997-01-21"",
            ""reportedEPS"": ""0.98"",
            ""estimatedEPS"": ""0.99"",
            ""surprise"": ""-0.01"",
            ""surprisePercentage"": ""-1.0101""
        },
        {
            ""fiscalDateEnding"": ""1996-09-30"",
            ""reportedDate"": ""1996-10-21"",
            ""reportedEPS"": ""0.61"",
            ""estimatedEPS"": ""0.61"",
            ""surprise"": ""0"",
            ""surprisePercentage"": ""0""
        },
        {
            ""fiscalDateEnding"": ""1996-06-30"",
            ""reportedDate"": ""1996-07-25"",
            ""reportedEPS"": ""0.63"",
            ""estimatedEPS"": ""0.61"",
            ""surprise"": ""0.02"",
            ""surprisePercentage"": ""3.2787""
        },
        {
            ""fiscalDateEnding"": ""1996-03-31"",
            ""reportedDate"": ""1996-04-17"",
            ""reportedEPS"": ""0.55"",
            ""estimatedEPS"": ""0.6"",
            ""surprise"": ""-0.05"",
            ""surprisePercentage"": ""-8.3333""
        }
    ]
}";

            using var client = new AlphaVantageClient(new MockHandler(json), string.Empty, int.MaxValue);
            var earnings = await client.EarningsAsync("IBM").ConfigureAwait(false);
            Assert.AreEqual(26, earnings.AnnualEarnings.Length);
            Assert.AreEqual(101, earnings.QuarterlyEarnings.Length);
            Assert.AreEqual(new DateTimeOffset(1996, 03, 31, 00, 00, 00, TimeSpan.Zero), earnings.QuarterlyEarnings[^1].FiscalDateEnding);
            Assert.AreEqual(new DateTimeOffset(1996, 04, 17, 00, 00, 00, TimeSpan.Zero), earnings.QuarterlyEarnings[^1].ReportedDate);
            Assert.AreEqual(0.55, earnings.QuarterlyEarnings[^1].ReportedEps, 0.001f);
            Assert.AreEqual(0.6, earnings.QuarterlyEarnings[^1].EstimatedEps, 0.001f);
            Assert.AreEqual(-0.05, earnings.QuarterlyEarnings[^1].Surprise, 0.001f);
            Assert.AreEqual(-0.083333, earnings.QuarterlyEarnings[^1].SurprisePercentage, 0.001f);
        }

        private class MockHandler : HttpMessageHandler
        {
            private readonly string json;

            internal MockHandler(string json)
            {
                this.json = json;
            }

            protected override Task<HttpResponseMessage> SendAsync(HttpRequestMessage request, CancellationToken cancellationToken)
            {
                return Task.FromResult(new HttpResponseMessage(HttpStatusCode.OK) { Content = new StringContent(this.json) });
            }
        }
    }
}
